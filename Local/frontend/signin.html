<!DOCTYPE html>
<html lang="en">
<head>
    <title>匠迪云</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="shortcut icon" href="./images/favicon.ico"/>



    <link rel="stylesheet" href="./dist/css/bootstrap.css">
    <link rel="stylesheet" href="./dist/css/common.css">
    <link rel="stylesheet" href="./dist/css/signin.css">
    <link rel="stylesheet" href="./dist/css/model.css">



</head>
<body>

<nav class="navbar navbar-default  navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html"><img src="./images/logo1.png" alt="" title="匠迪云安全"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse" >

            <ul class="nav navbar-nav ">
                <li><a href="../index.php">首页</a></li>
                <li><a href="##">产品介绍</a></li>
                <li><a href="##">产品服务</a></li>
                <li><a href="##">联系我们</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="login.html">登陆</a></li>
                <li><a href="signin.html" style="border-bottom: 4px solid #65b6fc;">注册</a></li>
            </ul>

        </div>
    </div>
</nav>


<div class="container">
    <div class="row main">
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <h2 class="title">欢迎使用<br>匠迪代码安全审查系统</h2>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <form action="" id="form" onsubmit="return false">
                <div class="xddw">
                    <p class="xddw-p"><input type="radio" name="register_type" value="1" id = "personal" class="xddw-radio" checked = checked><label for="personal"></label><span>个人用户</span></p>
                    <p class="xddw-p" style="left: 33%"><input type="radio" name="register_type" value="2" id = "public" class="xddw-radio"><label for="public"></label><span>企业用户</span></p>
                    <p class="xddw-p doubt" style="left: 66%" ><span style="font-size: 14px">用户权益详解</span></p>
                </div>

                <div class="xddw message company" style="display: none">
                    <span>公司名称：</span>
                    <input type="text" name="corporate_name" placeholder="请输入企业名称" class="message-input">
                    <p class="warning corporate_name"></p>
                </div>
                <div class="xddw message">
                    <span>用户名：</span>
                    <input type="text" name="nickname" placeholder="请输入用户名 中文 数字 字母（3-15）" class="message-input">
                    <p class="warning nickname"></p>
                </div>
                <div class="xddw message">
                    <span>手机号码：</span>
                    <input type="tel" name="phone" placeholder="请输入手机号码"  class="message-input"   oninput="checktel(this)" onblur="warning(this)">
                    <p class="warning warningtel phone"></p>
                </div>
                <div class="xddw message yz">
                    <span>验证码：</span>
                    <input type="text" name="phone_code" placeholder="请输入验证码" style="width: 40%" class="message-input">
                    <p class="warning phone_code"></p>
                    <button class="send-btn fs_code" type="button" onclick="settime(this)" >免费获取验证码</button>
                </div>

                <div class="xddw message">
                    <span>邮箱：</span>
                    <input type="email" name="email" placeholder="请输入E-mail" class="message-input">
                    <p class="warning email"></p>
                </div>

                <div class="xddw message">
                    <span>密码：</span>
                    <input type="password" name="password" placeholder="请输入密码 数字 字母 标点（6-20）" class="message-input">
                    <p class="warning password"></p>
                </div>

                <div class="xddw message">
                    <span>确认密码：</span>
                    <input type="password" name="password_ok" placeholder="请再次输入密码" class="message-input">
                    <p class="warning password_ok"></p>
                    <div class="notify" >
                            <input type="checkbox" id="check_box" checked="checked" >
                            <label for="check_box"></label>
                            <span id="notify-text">我已经阅读并同意<a class="btn " data-toggle="modal" data-target="#explain">《相关服务协议》</a></span>
                    </div>
                </div>

                <div class="xddw message">
                    <button class="register" type="submit" type = "button">注册</button>
                    <!--<button type="reset" value="复位" style="display:none;"></button>-->
                </div>
            </form>
        </div>
    </div>
</div>

<!---------------相关服务协议弹窗-------------->
<div class="modal fade" id="explain" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">-->
                    <!--&times;-->
                <!--</button>-->
                <h5 class="modal-title" id="myModalLabel">
                    用户权益详解
                </h5>
            </div>
            <div class="modal-body">
                在这里添加一些文本
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <!--<button type="button" class="btn btn-primary">-->
                    <!--提交更改-->
                <!--</button>-->
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<script src="./dist/js/jquery-3.1.1.min.js"></script>
<script src="./dist/js/bootstrap.min.js"></script>
<script>
//    公司名称出现与否
    $("#personal").click(function(){
        $(".company").css("display","none");
        $(".yz").css("display","none");
        $(".message-input").each(function(i){
            $(this).val("");
            $(".warning").eq(i).css("display","none");
        });
    });
    $("#public").click(function(){
        $(".company").css("display","block");
        $(".yz").css("display","none");
        $(".message-input").each(function(i){
            $(this).val("");
            $(".warning").eq(i).css("display","none");
        });
    });
//  手机号正则
    function checktel(obj){
        var val=$(obj).val().trim();
        var telvalid = /^1\d{10}$/;
        if (!telvalid.test(val)) {
            $(".yz").css("display", "none");
            return false;
        }else{
            $(".yz").css("display", "block");
            $(".warningtel").css("display","none");
        }
    }
//手机号警告
    function warning(obj){
        var val=$(obj).val().trim();
        var telvalid = /^1\d{10}$/;
        if (!telvalid.test(val)) {
            $(".warningtel").css("display","block");
            $(".warningtel").html("请输入正确的手机号码");
            return false;
        }else{

            $(".warningtel").css("display","none");
        }
    }
    $('.fs_code').click(function(){
        //发送验证码
        var phone = $("input[name=phone]").val();
        $.ajax({
            url: 'verification.php',
            type: "post",
            dataType:'json',
            data:{'phone':phone},
            success: function (data) {
                if(!data.success){
                    $(".warningtel").css("display","block");
                    $('.warningtel').html(data.res);
                }
            },
            error:function(){
                alert('验证码发送失败，请重新发送');
            }
        });
    });

//倒计时封装
    var countdown=60;
    function settime(obj) {
        if (countdown == 0) {
            $(obj).removeAttr("disabled");
            $(obj).html("免费获取验证码");
            countdown = 60;
            return;
        } else {
            $(obj).prop("disabled", true);
            $(obj).html("重新发送" + countdown);
            countdown--;
        }
        setTimeout(function() {
                    settime(obj)
        },1000)
    }
//  相关服务协议  （不应该通过点击事件，应该通过属性判断）
   var bol = true;
   $(".notify label").click(function(){
       if(bol){
           $(".register").prop("disabled", true);
//           $(".register").css({"color":"red"});
           bol = false;
       }else{
           $(".register").removeAttr("disabled");
//           $(".register").css({"color":"#ffffff"});
           bol = true;
       }
   })
    //错误信息提示
    function prompt_error(data){
        if(!data.success){
            var title = data.title;
            var result_err = data.result_err;
            $(".message-input").each(function(i){
                if($(this).attr('name') == title){
                    $('.'+title).css("display","block");
                    $('.'+title).html(result_err);
                }else{
                    $(".warning").eq(i).css("display","none");
                    $(".warning").eq(i).html('');
                }
            })
        }else{
            location.href = "index.php";
        }
    }
//判断输入是否为空
var  nullArr = ["公司名称不能为空","用户名不能为空","手机号码不能为空","验证码错误","邮箱不能为空","密码不能为空","密码不能为空"];
//用户注册
var reg_type = false;
$('.register').click(function(){
    $(".message-input").each(function(i){
        if($(this).val().trim() == ""){
            $(".warning").eq(i).css("display","block");
            $(".warning").eq(i).html(nullArr[i]);
            reg_type = false;
        }else{
            $(".warning").eq(i).css("display","none");
            $(".warning").eq(i).html('');
            reg_type = true;
        }
    })
    if(reg_type == true){
        $.ajax({
            url: 'register.php',
            type: "post",
            dataType:'json',
            data: $("#form").serialize(),
            success: function (data) {
                prompt_error(data);
            },
            error: function (err) {
                alert('注册失败, 请重新注册');
                location.href = "signin.html";
            }
        });
    }
});
</script>
</body>
</html>